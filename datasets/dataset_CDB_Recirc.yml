unique_name: dataset_CDB_Recirc
object_type: dataset
label: CDB Recirc
columns:
  - name: CDB Recirc ProjectID
    data_type: long
  - name: CDB Recirculated Net Income Global Practice
    data_type: string
  - name: CDB Recirculated Net Income Office Location
    data_type: string
  - name: CDB Recirculated Net Income Period
    data_type: datetime
  - name: CDBRecircCredit
    data_type: double
  - name: CDBRecircDebit
    data_type: double
  - name: CDB Recirc TaskID
    data_type: string
  - name: CDB Recirculated Net Income Company
    data_type: string
  - name: net
    data_type: double
  - name: CDB Recirculated Net Income Department
    data_type: string
  - name: countrows1
    data_type: int
    sql: '1'
connection_id: SQL42
sql: >-
  SELECT coalesce(nullif(CDBRecircAccounts.PROJECT_ID, '') ,
  convert(varchar(20), '1' + CDBRecircAccounts.segment1 +
  CDBRecircAccounts.segment2 + CDBRecircAccounts.segment3 +
  CDBRecircAccounts.segment4) -- fake project for each organization ) [CDB
  Recirc ProjectID] , case when nullif(CDBRecircAccounts.Project_ID, '') is not
  null then '-' + convert(varchar(10), CDBRecircAccounts.Project_ID) + '.' +
  CDBRecircAccounts.segment1 + CDBRecircAccounts.segment2 +
  CDBRecircAccounts.segment3 + CDBRecircAccounts.segment4 else '1' +
  CDBRecircAccounts.segment1 + CDBRecircAccounts.segment2 +
  CDBRecircAccounts.segment3 + CDBRecircAccounts.segment4 end [CDB Recirc
  TaskID] , CDBRecircAccounts.ACCOUNTED_CR [CDBRecircCredit] ,
  CDBRecircAccounts.ACCOUNTED_DR [CDBRecircDebit] , CDBRecircAccounts.net ,
  (select distinct left(Company,3) from PSRStage.dbo.GB_SegCmp where SEGMENT1 =
  CDBRecircAccounts.segment1) [CDB Recirculated Net Income Company] , (select
  distinct left(division,3) from PSRStage.dbo.GB_SegDiv where SEGMENT2 =
  CDBRecircAccounts.segment2) [CDB Recirculated Net Income Global Practice] ,
  (select distinct left(Location,3) from PSRStage.dbo.GB_SegLoc where SEGMENT3 =
  CDBRecircAccounts.segment3) [CDB Recirculated Net Income Office Location] ,
  (select distinct DEPARTMENT from PSRStage.dbo.GB_SegDept where SEGMENT4 =
  CDBRecircAccounts.segment4) [CDB Recirculated Net Income Department] ,
  try_convert(date, '01-' + CDBRecircAccounts.period_name) [CDB Recirculated Net
  Income Period] FROM AnalyticsSource.dbo.CDBRecircAccounts -- Current where
  CDBRecircAccounts.segment5 is null or CDBRecircAccounts.segment5 not in
  ('9848', '9849') --and CDBRecircAccounts.segment4 <> 999 union all SELECT
  coalesce(nullif(CDBRecircAccountsHistory.PROJECT_ID, '') ,
  convert(varchar(20), '1' + CDBRecircAccountsHistory.segment1 +
  CDBRecircAccountsHistory.segment2 + CDBRecircAccountsHistory.segment3 + '999')
  -- fake project for each organization ) [CDB Recirc ProjectID] , case when
  nullif(CDBRecircAccountsHistory.Project_ID, '') is not null then '-' +
  convert(varchar(10), CDBRecircAccountsHistory.Project_ID) + '.' +
  CDBRecircAccountsHistory.segment1 + CDBRecircAccountsHistory.segment2 +
  CDBRecircAccountsHistory.segment3 + '999' else '1' +
  CDBRecircAccountsHistory.segment1 + CDBRecircAccountsHistory.segment2 +
  CDBRecircAccountsHistory.segment3 + '999' end [CDB Recirc TaskID] ,
  CDBRecircAccountsHistory.ACCOUNTED_CR [CDBRecircCredit] ,
  CDBRecircAccountsHistory.ACCOUNTED_DR [CDBRecircDebit] ,
  CDBRecircAccountsHistory.net , (select distinct left(Company,3) from
  PSRStage.dbo.GB_SegCmp where SEGMENT1 = CDBRecircAccountsHistory.segment1)
  [CDB Recirculated Net Income Company] , (select distinct left(division,3) from
  PSRStage.dbo.GB_SegDiv where SEGMENT2 = CDBRecircAccountsHistory.segment2)
  [CDB Recirculated Net Income Global Practice] , (select distinct
  left(Location,3) from PSRStage.dbo.GB_SegLoc where SEGMENT3 =
  CDBRecircAccountsHistory.segment3) [CDB Recirculated Net Income Office
  Location] , null as [CDB Recirculated Net Income Department] -- all history
  records assigned to segment4 = 999 , try_convert(date, '01-' +
  CDBRecircAccountsHistory.period_name) [CDB Recirculated Net Income Period]
  FROM AnalyticsSource.dbo.CDBRecircAccountsHistory -- History where
  CDBRecircAccountsHistory.segment5 is null or CDBRecircAccountsHistory.segment5
  not in ('9848', '9849')
